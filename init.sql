-- 데이터베이스 생성 (만약 존재하지 않는다면)
CREATE DATABASE IF NOT EXISTS DOVE_STOCK;
-- DOVE_STOCK 데이터베이스 사용
USE DOVE_STOCK;

-- 1. KRX_DAILY_DATA 테이블 생성
CREATE TABLE KRX_DAILY_DATA (
    ID BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '고유 ID',
    -- LocalDateToTimestampConverter에 따라 TIMESTAMP 대신 BIGINT로 변경
    BASE_DATE BIGINT NOT NULL COMMENT '기준 날짜 (LocalDate -> Epoch Seconds)',
    MARKET_TYPE VARCHAR(20) NOT NULL COMMENT '시장 타입 (KOSPI, KOSDAQ 등)',
    RAW_DATA JSON COMMENT '원본 JSON 데이터',
    DATA_STATUS VARCHAR(20) NOT NULL COMMENT '데이터 처리 상태 (SUCCESS, API_FAILED 등)',
    -- LocalDateTimeToTimestampConverter에 따라 DATETIME 대신 BIGINT로 변경
    API_CALL_AT BIGINT NOT NULL COMMENT 'API 호출 시간 (LocalDateTime -> Epoch Seconds)'
);

CREATE INDEX IDX_BASE_DATE ON KRX_DAILY_DATA (BASE_DATE);

-- 2. STOCK 테이블 생성
CREATE TABLE STOCK (
    MARKET_TYPE VARCHAR(10) NOT NULL COMMENT '시장 타입 (KOSPI, KOSDAQ 등)',
    CODE VARCHAR(20) NOT NULL COMMENT '주식 코드',
    NAME VARCHAR(100) NOT NULL COMMENT '주식 이름',
    PRIMARY KEY (MARKET_TYPE, CODE)
);

-- 3. STOCK_DATE 테이블 생성
CREATE TABLE STOCK_DATE (
    DATE DATE NOT NULL PRIMARY KEY COMMENT '주식 날짜',
    UNIQUE (DATE)
);

-- 4. STOCK_DATA 테이블 생성
CREATE TABLE STOCK_DATA (
    MARKET_TYPE VARCHAR(10) NOT NULL COMMENT '시장 타입 (KOSPI, KOSDAQ 등)',
    STOCK_CODE VARCHAR(20) NOT NULL COMMENT '주식 코드',
    TRADE_DATE BIGINT NOT NULL COMMENT '거래 날짜',
    VOLUME BIGINT NOT NULL COMMENT '거래량',
    OPEN_PRICE DECIMAL(19, 2) NOT NULL COMMENT '시가',
    CLOSE_PRICE DECIMAL(19, 2) NOT NULL COMMENT '종가',
    LOW_PRICE DECIMAL(19, 2) NOT NULL COMMENT '저가',
    HIGH_PRICE DECIMAL(19, 2) NOT NULL COMMENT '고가',
    PRIMARY KEY (MARKET_TYPE, STOCK_CODE, TRADE_DATE)
);
